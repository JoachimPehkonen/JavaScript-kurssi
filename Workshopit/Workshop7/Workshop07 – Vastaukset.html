<!DOCTYPE html>
<HTML lang="fi">

<head>
	<meta charset="utf-8">
	<title>Työpaja 7 - Vastaukset</title>
	<link rel="stylesheet" href="css/styles.css">
</head>

<body class="ws7">
	<h1>Työpaja 7: JSON/XML:n parsiminen AJAXilla</h1>
	<hr />
	<p>Tässä harjoituksessa harjoittelemme JSONin käyttöä JavaScript-sovelluksissa. Käytä luentomateriaalia rinnalla
		viitteenä näiden tehtävien aikana.</p>

	<hr />
	<h2>Harjoitus 1: JSONin perusteet</h2>
	<p>JSON tarkoittaa JavaScript Object Notationia, ja se tarkoittaa, että esittelemme datan muodossa, jonka JavaScript
		ymmärtää sellaisenaan. Muunnoksia ei tarvita sen käyttämiseen.</p>
	<p>
		<button>Näytä vain etu- ja sukunimi</button>
		<button >Näytä kaikki tiedot</button>
	</p>
	<p>Kokeillaan seuraavaa. Voit luoda uuden JSON-datasetin JavaScript-koodissasi alla olevan mallin mukaisesti. Luo
		sitten funktiot, jotka suoritetaan, kun painikkeita klikataan.</p>

	<pre>
			var text = '{ "employees" : [' +
			'{ "firstName":"John" , "lastName":"Doe" },' +
			'{ "firstName":"Anna" , "lastName":"Smith" },' +
			'{ "firstName":"Peter" , "lastName":"Jones" } ]}';
		</pre>
	<ul>
		<li>Ensimmäinen painike näyttää etu- ja sukunimen jokaisesta kohteesta alla olevassa divissä.</li>
		<li>Toinen painike näyttää kaikki tiedot kaikista kohteista alla olevassa divissä. Halutessasi voit käyttää
			for-silmukoita tässä.</li>
	</ul>
	<div id="jsondata">JSON-data näkyy täällä.</div>
	<hr />
	<h2>Harjoitus 2: JSONin parsiminen verkosta</h2>
	<p>Alla näet kaksi painiketta. Muokkaa lähdekoodia ja lisää näihin painikkeisiin onClick-tapahtumat. Lisää
		toiminnallisuudet alla kuvatulla tavalla.</p>
	<p>
		<button>Lataa raaka data</button>
		<button>Lataa ja parsi data</button>
	</p>

	<ul>
		<li>Ensimmäisen painikkeen tulee suorittaa JavaScript-funktio, joka lataa annetun <a
				href="http://www.omdbapi.com/?s=star+wars&apikey=cbbc6750">JSON-tiedoston verkosta</a> ja näyttää sen
			raakatiedot alla olevassa divissä (id=rawdata). Käytä kehittäjätyökaluja (F12) seurataksesi AJAX-kutsua ja
			tutki otsikoita, suoritus­aikoja jne.</li>
		<li>Toisen painikkeen tulee suorittaa funktio, joka lataa saman datan, mutta parsii sen ja näyttää tiedot
			taulukossa.</li>
		<li>Kun olet saanut datan näkyviin, kokeile ladata myös kuvat sivulle.</li>
	</ul>
	<div id="rawdata">Raaka data näkyy täällä.</div>

	<hr />
	<h2>Harjoitus 3: Käytännön haaste: OpenWeatherMap API</h2>

	<p>OpenWeatherMap on tunnettu säädatan tarjoaja verkossa. Se tarjoaa API:n, jonka avulla kehittäjät voivat hakea
		säätietoja. <a href="https://openweathermap.org/api">Dokumentaatio löytyy täältä</a>.</p>
	<p>Tehtäväsi on kirjoittaa Sää-sovellus, joka näyttää säätiedot käyttäjän toiveiden mukaan. <b>Huomaa, että sinun
			täytyy rekisteröityä (ilmaista) saadaksesi API-avaimen, joka mahdollistaa palvelun käytön.</b></p>

	<p>Esimerkkikutsu REST API:iin voisi näyttää tältä: <a
			href="http://api.openweathermap.org/data/2.5/weather?q=Helsinki&units=metric&mode=JSON&APPID=ff64c247a136f706923d1ee0d55d71e2">http://api.openweathermap.org/data/2.5/weather?q=Helsinki&units=metric&mode=JSON&APPID=ff64c247a136f706923d1ee0d55d71e2</a>.
		Klikkaa nähdäksesi vastauksen.</p>
	<ul>
		<li>Kehitä ensin sovellus, joka näyttää raakatiedot säästä (lämpötila, pilvisyys, ilmankosteus) tietyssä
			kaupungissa, kun painiketta klikataan. <button id="search">Hae data</button></li>
		<li>Kun tämä toimii, parsi data ja tulosta se diviin.</li>
		<li>Tämän jälkeen lisää onchange-tapahtuma pudotusvalikkoon, jotta käyttäjä voi valita, minkä kaupungin tiedot
			näytetään listalta.</li>
		<li>Lopuksi lisää toiminnallisuus syötekenttään, johon käyttäjä voi kirjoittaa hakukyselyn, joka lähetetään
			OpenWeatherMap API:lle ja jonka tulokset näytetään sovelluksessa.</li>
	</ul>
	<p>Valitse kaupunki listalta:</p>
	<select name="mySelect" id="city" onchange="">
		<option value="Helsinki">Helsinki</option>
		<option value="Stockholm">Tukholma</option>
		<option value="Rome">Rooma</option>
		<option value="New York">New York</option>
	</select>
	<p>Tai kirjoita hakusana: <input id="citysearch" /><button>Hae</button></p>
	<div id="weatherdata">Säätiedot näkyvät täällä.</div>

	<script>

	// Tehtävä 1

	//Nappi 1
	document.querySelectorAll("button")[0].onclick = function() {
    var text = '{ "employees" : [' +
			'{ "firstName":"John" , "lastName":"Doe" },' +
			'{ "firstName":"Anna" , "lastName":"Smith" },' +
			'{ "firstName":"Peter" , "lastName":"Jones" } ]}';
	var obj = JSON.parse(text);
	var result = "";
	for (var i = 0; i < obj.employees.length; i++) {
		result += obj.employees[i].firstName + " " + obj.employees[i].lastName + "<br>";
	}
	document.getElementById("jsondata").innerHTML = result;

} 
	//Nappi 2
	document.querySelectorAll("button")[1].onclick = function() {
  var text = '{ "employees" : [' +
    '{ "firstName":"John" , "lastName":"Doe" },' +
    '{ "firstName":"Anna" , "lastName":"Smith" },' +
    '{ "firstName":"Peter" , "lastName":"Jones" } ]}';
  var obj = JSON.parse(text);

  var out = "";
  for (var i = 0; i < obj.employees.length; i++) {
    var e = obj.employees[i];
    for (var key in e) {
      out += key + ": " + e[key] + "<br>";
    }
    out += "<br>";
  }
  document.getElementById("jsondata").innerHTML = out;
};


	// Tehtävä 2

	//Nappi 1
	document.querySelectorAll("button")[2].onclick = function() {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				document.getElementById("rawdata").innerHTML = this.responseText;
			}
		};
		xhttp.open("GET", "https://www.omdbapi.com/?s=star+wars&apikey=cbbc6750", true);
		xhttp.send();
		}
	
	//Nappi 2
	document.querySelectorAll("button")[3].onclick = function() {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var response = JSON.parse(this.responseText);
				var out = "<table><tr><th>Title</th><th>Year</th><th>Poster</th></tr>";
				for (var i = 0; i < response.Search.length; i++) {
					out += "<tr><td>" + response.Search[i].Title + "</td><td>" + response.Search[i].Year + "</td><td><img src='" + response.Search[i].Poster + "' alt='Poster' height='100'></td></tr>";
				}
				out += "</table>";
				document.getElementById("rawdata").innerHTML = out;
			}
		};
		xhttp.open("GET", "https://www.omdbapi.com/?s=star+wars&apikey=cbbc6750", true);
		xhttp.send();
	}

	// Tehtävä 3
	document.querySelector("button#search").onclick = function() {
		var city = document.getElementById("citysearch").value;
		fetchWeatherData(city);
	};
	document.getElementById("city").onchange = function() {
		var city = this.value;
		fetchWeatherData(city);
	};
	function fetchWeatherData(city) {
		var apiKey = "b4d9ee1bc9ca273b100f0093ce19a4c5";
		var url = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=metric&mode=JSON&APPID=" + apiKey;

		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var response = JSON.parse(this.responseText);
				var out = "<h3>Sää " + response.name + "</h3>";
				out += "<p>Lämpötila: " + response.main.temp + " °C</p>";
				out += "<p>Pilvisyys: " + response.weather[0].description + "</p>";
				out += "<p>Ilmankosteus: " + response.main.humidity + " %</p>";
				document.getElementById("weatherdata").innerHTML = out;
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}


	


	</script>

</body>

</html>